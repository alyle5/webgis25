<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEF Web Map</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@7.5.2/ol.css">

    <style>
        html, body { margin: 0; padding: 0; height: 100%; font-family: Arial, sans-serif; }
        #map { width: 100%; height: 100%; }

        /* Layer Switcher */
        .layer-switcher {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #ffffff;
            padding: 12px 16px;
            border-radius: 10px;
            box-shadow: 0 3px 12px rgba(0,0,0,0.25);
            z-index: 1000;
            width: 180px;
        }

        .layer-switcher h3 {
            margin: 0 0 10px 0;
            font-size: 17px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 6px;
        }

        .layer-switcher label {
            display: block;
            margin: 6px 0;
            font-size: 14px;
        }
    </style>
</head>

<body>

<div class="layer-switcher">
    <h3>Layers</h3>
    <label><input type="checkbox" id="boundary" checked> SEF Boundary (100ft)</label>
    <label><input type="checkbox" id="roads" checked> Roads</label>
    <label><input type="checkbox" id="streams" checked> Streams</label>
</div>

<div id="map"></div>

<script src="https://cdn.jsdelivr.net/npm/ol@7.5.2/dist/ol.js"></script>
<script>

// ========== MAP INITIALIZATION ==========
const map = new ol.Map({
    target: 'map',
    layers: [
        new ol.layer.Tile({ source: new ol.source.OSM() })
    ],
    view: new ol.View({
        center: ol.proj.fromLonLat([-80, 35]), // temporary, replaced after zoom
        zoom: 10
    })
});

// ========== WMS LAYER FACTORY ==========
function createWMS(layerName) {
    return new ol.layer.Tile({
        source: new ol.source.TileWMS({
            url: 'http://3.236.80.74:8080/geoserver/wms',
            params: {
                LAYERS: layerName,
                FORMAT: 'image/png',
                TILED: true,
                TRANSPARENT: true
            },
            serverType: 'geoserver'
        }),
        visible: true
    });
}

// ========== CREATE YOUR LAYERS ==========
const boundaryLayer = createWMS('alyle5:sef_boundary_100ft');
const roadsLayer    = createWMS('alyle5:sef_roads');
const streamsLayer  = createWMS('alyle5:sef_streams');

map.addLayer(boundaryLayer);
map.addLayer(roadsLayer);
map.addLayer(streamsLayer);

// ========== LAYER TOGGLES ==========
document.getElementById("boundary").onchange = e => boundaryLayer.setVisible(e.target.checked);
document.getElementById("roads").onchange    = e => roadsLayer.setVisible(e.target.checked);
document.getElementById("streams").onchange  = e => streamsLayer.setVisible(e.target.checked);


// ======================================================================
// AUTO-ZOOM TO LAYER EXTENT (reads BBOX from GeoServer GetCapabilities)
// ======================================================================

// Use proxy-safe XML parsing (no CORS issues)
fetch("http://3.236.80.74:8080/geoserver/alyle5/wms?service=WMS&request=GetCapabilities")
    .then(res => res.text())
    .then(xmlText => {
        const parser = new ol.format.WMSCapabilities();
        const capabilities = parser.read(xmlText);

        // Find your layer's metadata
        const layers = capabilities.Capability.Layer.Layer;
        const layerInfo = layers.find(l => l.Name === "alyle5:sef_boundary_100ft");

        if (!layerInfo || !layerInfo.BoundingBox) {
            console.error("Could not read bounding box for layer.");
            return;
        }

        // Extract BBOX
        const bbox = layerInfo.BoundingBox[0].extent;

        // Convert to Web Mercator
        const extent3857 = ol.proj.transformExtent(bbox, 'EPSG:4326', 'EPSG:3857');

        // Fit map to extent
        map.getView().fit(extent3857, {
            duration: 1000,
            padding: [50, 50, 50, 50]
        });
    })
    .catch(err => console.error("Capabilities load error:", err));

</script>

</body>
</html>
