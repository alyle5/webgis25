<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEF GIS WebClient</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@latest/ol.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <script src="https://cdn.jsdelivr.net/npm/ol@latest/ol.js"></script>
    <script>

        // ---------------------------
        // BASEMAP
        // ---------------------------
        const osm = new ol.layer.Tile({
            source: new ol.source.OSM(),
        });

        // ---------------------------
        // GEOSERVER WMS LAYERS
        // ---------------------------
        const geoserverUrl = "http://3.236.80.74:8080/geoserver/wms";

        const boundary = new ol.layer.Tile({
            title: "Boundary",
            source: new ol.source.TileWMS({
                url: geoserverUrl,
                params: {
                    LAYERS: "alyle5:sef_boundary_100ft",
                    TILED: true
                },
                serverType: "geoserver"
            })
        });

        const roads = new ol.layer.Tile({
            title: "Roads",
            source: new ol.source.TileWMS({
                url: geoserverUrl,
                params: {
                    LAYERS: "alyle5:sef_roads",
                    TILED: true
                },
                serverType: "geoserver"
            })
        });

        const bridges = new ol.layer.Tile({
            title: "Bridges",
            source: new ol.source.TileWMS({
                url: geoserverUrl,
                params: {
                    LAYERS: "alyle5:sef_bridges",
                    TILED: true
                },
                serverType: "geoserver"
            })
        });

        // ---------------------------
        // MAP
        // ---------------------------
        const map = new ol.Map({
            target: "map",
            layers: [osm, boundary, roads, bridges],
            view: new ol.View({
                center: ol.proj.fromLonLat([-90, 40]),   // temporary center
                zoom: 4                                  // temporary zoom
            })
        });

        // ---------------------------
        // AUTO-ZOOM TO BOUNDARY LAYER
        // ---------------------------
        fetch("http://3.236.80.74:8080/geoserver/wms?service=WMS&version=1.1.1&request=GetCapabilities")
            .then(response => response.text())
            .then(text => {

                const parser = new DOMParser();
                const xml = parser.parseFromString(text, "text/xml");

                const layerNodes = xml.getElementsByTagName("Layer");

                for (let i = 0; i < layerNodes.length; i++) {
                    const nameNode = layerNodes[i].getElementsByTagName("Name")[0];
                    if (!nameNode) continue;

                    if (nameNode.textContent === "alyle5:sef_boundary_100ft") {

                        const bboxNode = layerNodes[i].getElementsByTagName("LatLonBoundingBox")[0];
                        if (bboxNode) {
                            const minx = parseFloat(bboxNode.getAttribute("minx"));
                            const miny = parseFloat(bboxNode.getAttribute("miny"));
                            const maxx = parseFloat(bboxNode.getAttribute("maxx"));
                            const maxy = parseFloat(bboxNode.getAttribute("maxy"));

                            const extent = ol.proj.transformExtent(
                                [minx, miny, maxx, maxy],
                                "EPSG:4326",
                                "EPSG:3857"
                            );

                            map.getView().fit(extent, { duration: 1000 });
                        }

                    }
                }
            })
            .catch(err => console.error("Error loading GetCapabilities:", err));

    </script>

</body>
</html>
